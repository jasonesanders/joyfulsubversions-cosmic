---

---

<div class="noisy-gradient-container">
  <div class="gradient-blobs">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>
  <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
    <filter id="grainyGradientNoise">
      <feTurbulence
        type="fractalNoise"
        baseFrequency="0.6"
        numOctaves="3"
        stitchTiles="stitch"></feTurbulence>
      <feColorMatrix type="saturate" values="0"></feColorMatrix>
      <!-- Grayscale -->
    </filter>
    <rect
      width="100%"
      height="100%"
      filter="url(#grainyGradientNoise)"
      opacity="1"></rect>
  </svg>
</div>

<style>
  .noisy-gradient-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    pointer-events: none;
    overflow: hidden;
    background-color: var(--bg-base, #333333);
    transition: background-color 0.5s ease;
  }

  .gradient-blobs {
    position: absolute;
    inset: 0;
    /* Reduced blur for more defined shapes as requested */
    filter: blur(40px) contrast(120%);
  }

  .blob {
    position: absolute;
    border-radius: 50%;
    opacity: 0; /* Start hidden for solid top */
    transition: background-color 0.5s ease;
    mix-blend-mode: screen; /* Helps colors pop against dark bg */
  }

  /* Top Left Blob - Starts off-screen or very low opacity */
  .blob-1 {
    top: 10%;
    left: -10%;
    width: 60vw;
    height: 60vw;
    background-color: var(--blob-1-color, #C05746);
    transform: translate(-50%, -50%);
  }

  /* Center Right Blob */
  .blob-2 {
    top: 40%;
    right: -20%;
    width: 50vw;
    height: 50vw;
    background-color: var(--blob-2-color, #0081A7);
    transform: translate(50%, -50%);
  }

  /* Bottom Left Blob */
  .blob-3 {
    bottom: -20%;
    left: 20%;
    width: 70vw;
    height: 70vw;
    background-color: var(--blob-3-color, #0081A7);
    transform: translate(-50%, 50%);
  }

  svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* CSS-Tricks Grainy Gradient Technique: 
       Overlay blend mode + Contrast on the noise layer itself */
    mix-blend-mode: overlay;
    filter: contrast(150%) brightness(100%);
    opacity: 0.5;
    pointer-events: none;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // Palette: #333333 -> #643173 -> #7d5ba6 -> #86a59c -> #89ce94
  // Palette: Carbon -> Rosy Copper/Cerulean/Vanilla -> Shuffle
  const palette = [
    { base: "#262624", blob1: "#c05746", blob2: "#0081a7", blob3: "#f3dfa2" }, // Start
    { base: "#262624", blob1: "#0081a7", blob2: "#f3dfa2", blob3: "#c05746" }, // Middle
    { base: "#262624", blob1: "#f3dfa2", blob2: "#c05746", blob3: "#0081a7" }, // End
  ];

  const container = document.querySelector(
    ".noisy-gradient-container",
  ) as HTMLElement;
  const blobs = document.querySelectorAll(".blob");

  if (container && blobs.length) {
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: "body",
        start: "top top",
        end: "bottom bottom",
        scrub: 0.5,
      },
    });

    // Initial State: Solid Top (Blobs hidden or very subtle)
    gsap.set(container, { "--bg-base": palette[0].base });
    gsap.set(blobs, { opacity: 0, scale: 0.8 });

    // Animation Sequence

    // 1. Fade in blobs as we scroll down from Hero
    tl.to(
      blobs,
      {
        opacity: 0.8,
        scale: 1,
        duration: 0.2,
        stagger: 0.1,
      },
      0,
    );

    // 2. Move blobs around to create "transition"
    tl.to(".blob-1", { top: "30%", left: "10%", rotation: 45, duration: 1 }, 0);
    tl.to(
      ".blob-2",
      { top: "60%", right: "10%", rotation: -45, duration: 1 },
      0,
    );
    tl.to(
      ".blob-3",
      { bottom: "10%", left: "30%", rotation: 20, duration: 1 },
      0,
    );

    // 3. Color Cycle
    // We'll interpolate the CSS variables for colors
    palette.forEach((colors, index) => {
      if (index === 0) return;

      tl.to(
        container,
        {
          "--bg-base": colors.base,
          "--blob-1-color": colors.blob1,
          "--blob-2-color": colors.blob2,
          "--blob-3-color": colors.blob3,
          ease: "none",
          duration: 1 / (palette.length - 1),
        },
        (index - 1) / (palette.length - 1),
      );
    });
  }
</script>
